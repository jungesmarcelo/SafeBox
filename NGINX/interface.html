<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>

	<script src="mqttws31.js" type="text/javascript"></script>

    <link rel="stylesheet" href="css/style_interface.css">

    <title>Projeto integrador</title>
    <link rel="shortcut icon" type="image-x/png" href="icon/icon.svg">

	<script type="text/javascript">
		 //Using the HiveMQ public Broker, with a random client Id
 var client = new Messaging.Client("161.35.1.122", 8080, "myclientid_" + parseInt(Math.random() * 100, 10));

 //Gets  called if the websocket/mqtt connection gets disconnected for any reason
 client.onConnectionLost = function (responseObject) {
     //Depending on your scenario you could implement a reconnect logic here
     alert("connection lost: " + responseObject.errorMessage);
 };

 //Gets called whenever you receive a message for your subscriptions
 client.onMessageArrived = function (message) {
     //Do something with the push message you received
     $('#messages').html(`<h1>${message.payloadString}</h1>`);
     console.log(message.payloadString)
 };


 //Connect Options
 var options = {
     timeout: 3,
     //Gets Called if the connection has sucessfully been established
     onSuccess: function () {
         alert("Connected");
     },
     //Gets Called if the connection could not be established
     onFailure: function (message) {
         alert("Connection failed: " + message.errorMessage);
     }
 };

 //Creates a new Messaging.Message Object and sends it to the HiveMQ MQTT Broker
 var publish = function (payload, topic, qos) {
     //Send your message (also possible to serialize it as JSON or protobuf or just use a string, no limitations)
     var message = new Messaging.Message(payload);
     message.destinationName = topic;
     message.qos = qos;
     client.send(message);
 }
	</script>


</head>

<body>
	<script>

	client.connect(options);
    client.subscribe('status/box', {qos: 2}); alert('Subscribed');
	
	</script>

    <div class="container">
        <button class="connect" onclick="client.connect(options); ">Reload</button>
        <button class="connect" onclick="client.subscribe('status/box', {qos: 2}); alert('Connected');">Connect</button>
        <!-- <button class="subscrive" onclick="client.subscribe('tranca', {qos: 1}); alert('Subscribed');">Subscribe2</button> -->
        <button class="subscrive" onclick="publish('1','motor',2);">Open</button>
        <button class="subscrive" onclick="publish('2','motor',2);">Close</button>
        <!-- <button class="subscrive" onclick="publish('3','motor',2);">5. Travar</button>
        <button class="subscrive" onclick="publish('4','motor',2);">6. Destravar</button> -->
        <button class="connect" onclick="client.disconnect();">Disconnect</button>
        <div class="count">
            <div id="messages">
                
            </div>
        </div>
    </div>
</body>
